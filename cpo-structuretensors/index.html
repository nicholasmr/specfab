<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Structure tensors - specfab documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Structure tensors";
        var mkdocs_page_input_path = "cpo-structuretensors.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> specfab documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">üìñ About</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../install/">üì¶ Install</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">üíé CPO representation</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../cpo-representation/">Representation</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Structure tensors</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#principal-frame">Principal frame</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#convert-to-spectral">Convert to spectral</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#construct-from-measurements">Construct from measurements</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cpo-statespace/">State space</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">‚öôÔ∏è CPO Dynamics</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../fabdyn-matrix-model/">Matrix model</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fabdyn-LROT/">Lattice rotation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fabdyn-DDRX/">Discontinous DRX</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fabdyn-CDRX/">Continous DRX</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fabdyn-REG/">Regularization</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">üåÄ Viscosity</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../enhancements-strainrate/">Strain-rate enhancement</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../enhancements-strainrate-ice/">Glacier ice</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../enhancements-strainrate-olivine/">Olivine</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">üåä Wave propagation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../waveprop-elastic/">Elastic</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../waveprop-electromagnetic/">Electromagnetic</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">üñºÔ∏è Application Gallery</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../gallery-Lagrangian-CPO-parcel/">Lagrangian CPO parcel</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../gallery-Eulerian-CPO-field/">Eulerian CPO field</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../gallery-CPO-from-radar/">Inferring CPO from radar</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../gallery-CPO-flow-coupling/">Coupling CPO and flow</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">üß© Miscellaneous</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../deformation-kinematics/">Deformation kinematics</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cpo-plot/">Plot CPO</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cpo-rotation/">Rotate CPO</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../constitutive-viscoplastic/">Viscoplastic constitutive eqns.</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../constitutive-elastic/">Elastic constitutive eqns.</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">specfab documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>üíé CPO representation &raquo;</li>
      <li>Structure tensors</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="structure-tensors">Structure tensors</h1>
<p><em>Structure tensors</em> <span class="arithmatex">\({\bf a}^{(k)}\)</span> are defined as the mean of the <span class="arithmatex">\(k\)</span>-th repeated outer product of a crystallographic axis with itself, say <span class="arithmatex">\(\bf n\)</span>:</p>
<div class="arithmatex">\[ 
{\bf a}^{(k)} := \langle {\bf n}^k \rangle.
\]</div>
<p>In the case of a discrete ensemble of <span class="arithmatex">\(N\)</span> grains with slip plane normals <span class="arithmatex">\({\bf n}_i\)</span> for <span class="arithmatex">\(i=1,\cdots,N\)</span>, the structure tensors are </p>
<div class="arithmatex">\[ 
{\bf a}^{(k)} = \dfrac{\sum_i w_i {\bf n}_i^k}{\sum_i w_i},
\]</div>
<p>where <span class="arithmatex">\(w_i\)</span> is the <em>weight</em> attributed to the <span class="arithmatex">\(i\)</span>-th grain, typically its size. </p>
<p>Alternatively, if the distribution function <span class="arithmatex">\(n(\theta,\phi)\)</span> of <span class="arithmatex">\({\bf n}\)</span>-axes is known, the structure tensors are </p>
<div class="arithmatex">\[ 
{\bf a}^{(k)} = \dfrac{\int_{S^2} n \hat{{\bf r}}^k \, \mathrm{d}\Omega}{\int_{S^2} n \, \mathrm{d}\Omega} 
,
\]</div>
<p>where <span class="arithmatex">\(\mathrm{d}\Omega = \sin(\theta) \mathrm{d}\theta \mathrm{d}\phi\)</span> is the infinitesimal solid angle and <span class="arithmatex">\(\hat{{\bf r}}(\theta,\phi)\)</span> is the radial unit vector.</p>
<h2 id="principal-frame">Principal frame</h2>
<p>Since <span class="arithmatex">\(n(\theta,\phi)\)</span> and <span class="arithmatex">\(b(\theta,\phi)\)</span> are antipodally symmetric, odd moments (odd <span class="arithmatex">\(k\)</span>) vanish identically. Hence, <span class="arithmatex">\({\bf a}^{(2)}(n)\)</span> and  <span class="arithmatex">\({\bf a}^{(2)}(b)\)</span> measure the variance of <span class="arithmatex">\(\bf n\)</span>- and <span class="arithmatex">\(\bf b\)</span>-axes, respectively, around the three coordinate axes.</p>
<p>Posing <span class="arithmatex">\({\bf a}^{(2)}\)</span> in its principal frame</p>
<div class="arithmatex">\[ 
{\bf a}^{(2)} = \left[\begin{matrix}
\lambda_1 &amp; 0 &amp; 0\\ 
0 &amp; \lambda_2 &amp; 0\\ 
0 &amp; 0 &amp; \lambda_3\\ 
\end{matrix}\right]
\]</div>
<p>therefore has a similar interpretation as in PCA:
the first principal component (eigenvector <span class="arithmatex">\({\bf m}_1\)</span>) is the direction that maximizes the variance (eigenvalue <span class="arithmatex">\(\lambda_1\)</span>) of the projected data (red curve), the second component is the direction orthogonal to the first component that maximizes the variance of the projected data, and so on with the third component. </p>
<div style="width: 100%; text-align: center;">
<p><img alt="" src="https://raw.githubusercontent.com/nicholasmr/specfab/refs/heads/main/images/harmonic-expansion/a2.png#center" style="width:600px" /></p>
</div>
<h2 id="convert-to-spectral">Convert to spectral</h2>
<p>Converting between spectral and tensorial representations is a linear problem in the sense that </p>
<div class="arithmatex">\[
{\bf a}^{(k)} = {\bf f}(\hat{n}_2^{m}, \hat{n}_4^{m}, \cdots, \hat{n}_k^{m}) 
,
\qquad\text{(for all $m$)}
\]</div>
<p>where <span class="arithmatex">\({\bf f}\)</span> is linear in its arguments and <span class="arithmatex">\(\hat{n}_l^m = n_l^m/n_0^0\)</span>.</p>
<p>In the case of <span class="arithmatex">\({\bf a}^{(2)}\)</span>, the relation is simple:</p>
<div class="arithmatex">\[
{\bf a}^{(2)} = \frac{{\bf I}}{3} + \sqrt{\frac{2}{15}}
\left[\begin{matrix}
\operatorname{Re}[\hat{n}_2^2] - \dfrac{1}{2}\sqrt{\dfrac{2}{3}} \hat{n}_2^0 &amp; -\operatorname{Im}[\hat{n}_2^2] &amp; -\operatorname{Re}[\hat{n}_2^1] \\ 
 &amp; -\operatorname{Re}[\hat{n}_2^2] - \dfrac{1}{2}\sqrt{\dfrac{2}{3}} \hat{n}_2^0  &amp; \operatorname{Im}[\hat{n}_2^1] \\ 
\mathrm{sym.} &amp;  &amp; \sqrt{\dfrac{2}{3}} \hat{n}_2^0
\end{matrix}\right]
,
\]</div>
<p>but for higher-order structure tensors the expressions are long (not shown).
The above applies to <span class="arithmatex">\(b(\theta,\phi)\)</span> as well.</p>
<p>The following code example shows how to convert between the two CPO representations:</p>
<pre><code class="language-python">import numpy as np
from specfabpy import specfab as sf
lm, nlm_len = sf.init(8)
nlm = np.zeros((nlm_len), dtype=np.complex64) # state vector (array of expansion coefficients)

### a2 to nlm
a2 = np.diag([0.0,0.25,0.75]) # some second-order structure tensor
nlm[:sf.L2len] = sf.a2_to_nlm(a2) # l&lt;=2 expansion coefficients
a2 = sf.a2(nlm) # nlm back to a2
print('a2 is: ', a2)

### a4 to nlm
p = np.array([0,0,1]) # unidirectional CPO
a4 = np.einsum('i,j,k,l', p,p,p,p) # = deltafunction(r-p) 
nlm[:sf.L4len] = sf.a4_to_nlm(a4) # l&lt;=4 expansion coefficients
a4 = sf.a4(nlm) # nlm back to a4 
print('a4 is: ', a4)

### a6 to nlm
p = np.array([0,0,1]) # unidirectional CPO
a6 = np.einsum('i,j,k,l,m,n', p,p,p,p,p,p) # = deltafunction(r-p) 
nlm[:sf.L6len] = sf.a6_to_nlm(a6) # l&lt;=6 expansion coefficients
a6 = sf.a6(nlm) # nlm back to a6
print('a6 is: ', a6)
</code></pre>
<h2 id="construct-from-measurements">Construct from measurements</h2>
<p>The harmonic expansion coefficients of any CPO can be determined from discrete measurements of its crystallographic axes.
This requires constructing the corresponding structure tensors (of each crystallographic axis), from which the expansion coefficients may be derived.</p>
<p>In the case of glacier ice where <span class="arithmatex">\({\bf n} = {\bf c}\)</span>, this can be done as follows:</p>
<pre><code class="language-python">import numpy as np
from specfabpy import specfab as sf
lm, nlm_len = sf.init(8) 

### Replace with your own array/list of measured c-axes
# caxes = [[c1x,c1y,c1z], [c2x,c2y,c2z], ...] 

### Determine sixth-order structure tensor
a6 = np.zeros((3,3,3,3,3,3))
for c in caxes
    a6 += np.einsum('i,j,k,l,m,n', c,c,c,c,c,c) # sixth outer product of c-axis with itself
a6 /= len(caxes) # normalize by number of c-axes (grains) if grain sizes are not known

### Determine state vector
nlm = np.zeros((nlm_len), dtype=np.complex64) # state vector (array of expansion coefficients)
nlm[:sf.L6len] = sf.a6_to_nlm(a6) # l&lt;=6 expansion coefficients
</code></pre>
<p>Note that constructing <span class="arithmatex">\({\bf a}^{(6)}\)</span> is to be preferred over <span class="arithmatex">\({\bf a}^{(4)}\)</span> and <span class="arithmatex">\({\bf a}^{(2)}\)</span>, since it contains more information on the fine-scale structure of the distribution: <span class="arithmatex">\({\bf a}^{(6)}\)</span> encodes information about the expansion coefficients <span class="arithmatex">\(l\leq 6\)</span>, <span class="arithmatex">\({\bf a}^{(4)}\)</span> about <span class="arithmatex">\(l\leq 4\)</span>, and <span class="arithmatex">\({\bf a}^{(2)}\)</span> about <span class="arithmatex">\(l\leq 2\)</span>. </p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../cpo-representation/" class="btn btn-neutral float-left" title="Representation"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../cpo-statespace/" class="btn btn-neutral float-right" title="State space">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../cpo-representation/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../cpo-statespace/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
