<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Representation - specfab documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Representation";
        var mkdocs_page_input_path = "cpo-representation.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> specfab documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">About</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../initialize/">Loading specfab</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">CPO</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Representation</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#series-expansion">Series expansion</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#normalization">Normalization</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#reduced-form">Reduced form</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#structure-tensors">Structure tensors</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#constructing-cpos-from-measurements">Constructing CPOs from measurements</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cpo-dynamics/">Dynamics</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cpo-rotation/">Rotation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cpo-plot/">Plotting</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Constitutive equations</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../constitutive-viscoplastic/">Viscoplastic</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../constitutive-elastic/">Elastic</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../enhancements-strainrate/">Strain-rate enhancements</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Wave propagation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../wavepropagation-elastic/">Elastic</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../wavepropagation-electromagnetic/">Electromagnetic</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">specfab documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>CPO &raquo;</li>
      <li>Representation</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="cpo-representation">CPO representation</h1>
<p>CPOs are represented by the distribution(s) of crystallographic axes in orientation space, <span class="arithmatex">\(S^2\)</span>.
<br>
Supported grain symmetry groups are</p>
<table>
<thead>
<tr>
<th>Grain symmetry</th>
<th>CPO components</th>
<th>Interpretation</th>
</tr>
</thead>
<tbody>
<tr>
<td>Transversely isotropic</td>
<td><span class="arithmatex">\(n(\theta,\phi)\)</span></td>
<td>Distribution of slip-plane normals</td>
</tr>
<tr>
<td>Orthotropic</td>
<td><span class="arithmatex">\(n(\theta,\phi),b(\theta,\phi)\)</span></td>
<td>Distribution of slip-plane normals and slip directions</td>
</tr>
</tbody>
</table>
<p>E.g.:</p>
<table>
<thead>
<tr>
<th align="center">Polycrystalline ice</th>
<th align="center">Polycrystalline olivine</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="" src="https://raw.githubusercontent.com/nicholasmr/specfab/main/images/tranisotropic/polycrystal.png" style="width:200px" /></td>
<td align="center"><img alt="" src="https://raw.githubusercontent.com/nicholasmr/specfab/main/images/orthotropic/polycrystal.png" style="width:200px" /></td>
</tr>
</tbody>
</table>
<p>where <span class="arithmatex">\(n(\theta,\phi)\)</span> is the <span class="arithmatex">\(c\)</span>-axis distribution for polycrystalline ice, 
whereas which crystallographic axes (<span class="arithmatex">\({\bf r}_i\)</span>) the distributions <span class="arithmatex">\(n(\theta,\phi)\)</span> and <span class="arithmatex">\(b(\theta,\phi)\)</span> refer to for polycrystalline olivine depends on the fabric type and hence on physical conditions such as thermodynamic conditions, water content, and stress magnitude.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Grain sizes or shapes are not represented or modelled by specfab.</p>
</div>
<h2 id="series-expansion">Series expansion</h2>
<p>CPOs are represented by expanding their distributions of crystallographic axes in terms of spherical harmonic expansion series.</p>
<p>E.g. for transversely isotropic grains where only <span class="arithmatex">\(n(\theta,\phi)\)</span> is relevant:
$$ 
n(\theta,\phi)=\sum_{l=0}^{L}\sum_{m=-l}^{l}n_{l}^{m}Y_{l}^{m}(\theta,\phi) \quad\text{(distribution of slip-plane normals)}.
$$</p>
<p>The orientation distribution function (ODF) is defined as the normalized distribution </p>
<div class="arithmatex">\[ 
\mathrm{ODF} := \frac{n(\theta,\phi)}{N} \quad\text{where}\quad N=\int_{S^2}{n} d\Omega=\sqrt{4\pi}n_0^0 .
\]</div>
<p>The array of complex-valued expansion coefficients is defined as</p>
<p><span class="arithmatex">\(\qquad\)</span> <code>nlm</code> <span class="arithmatex">\(= [n_0^0,n_2^{-2},n_2^{-1},n_2^{0},n_2^{1},n_2^{2},n_4^{-4},\cdots,n_4^{4},\cdots,n_L^{-L},\cdots,n_L^{L}] \quad\text{(state vector)}\)</span>.</p>
<h3 id="normalization">Normalization</h3>
<p><span class="arithmatex">\(n(\theta,\phi)\)</span> may be understood either as the number density of grains with a given slip-plane normal orientation, or as the mass density fraction (<a href="https://royalsocietypublishing.org/doi/abs/10.1098/rspa.2005.1610">Faria, 2006</a>) of grains with a given slip-plane normal orientation.</p>
<p>From specfab's point-of-view, the difference is a matter of normalization: since the models of <a href="../cpo-dynamics/">CPO evolution</a> (lattice rotation, DDRX, CDRX) conserve the normalization, the two views are effectively the same, not least because CPO-derived quantities depend on the normalized distributions (which are identical).
The mass-density-fraction interpretation rests, however, on stronger physical grounds as mass is conserved but grain numbers are not.</p>
<h2 id="reduced-form">Reduced form</h2>
<p>Not all expansion coefficients are independent for real-valued expansion series, but must fulfill</p>
<div class="arithmatex">\[ 
n_l^{-m}=(-1)^m(n_l^m)^* .
\]</div>
<p>This can be taken advantage of for large problems where many (e.g. gridded) CPOs need to be stored in memory, thereby effectively reducing the size of the problem. 
The reduced array of expansion coefficients</p>
<p><span class="arithmatex">\(\qquad\)</span> <code>rnlm</code> <span class="arithmatex">\(= [n_0^0,n_2^{0},n_2^{1},n_2^{2},n_4^{0},\cdots,n_4^{4},\cdots,n_L^{0},\cdots,n_L^{L}] \quad\text{(reduced state vector)}\)</span></p>
<p>can be constructed as follows:</p>
<pre><code class="language-python">import numpy as np
from specfabpy import specfabpy as sf
lm, nlm_len = sf.init(2) # L=2 truncation is sufficient in this case

# Construct an arbitrary fabric
a2 = np.diag([0.1,0.2,0.7]) # any second-order structure tensor (not necessarily diagonal)
nlm = np.zeros((nlm_len), dtype=np.complex64) # array of expansion coefficients
nlm[0:6] = sf.a2_to_nlm(a2) # l=2 expansion coefficients for corresponding ODF (a2 is normalized)
print('original:', nlm)

# Get reduced form of coefficient array, rnlm
rnlm_len = sf.get_rnlm_len() 
rnlm = np.zeros((rnlm_len), dtype=np.complex64) # array of reduced expansion coefficients
rnlm[:] = sf.nlm_to_rnlm(nlm, rnlm_len) # reduced form
print('reduced:', rnlm)

# Recover full form (nlm) from reduced form (rnlm)
nlm[:] = sf.rnlm_to_nlm(rnlm, nlm_len)
print('recovered:', nlm)
</code></pre>
<h2 id="structure-tensors">Structure tensors</h2>
<p>The 2nd-, 4th- and 6th-order structure tensors (<code>a2</code>, <code>a4</code>, <code>a6</code>) are the average outer products of a crystallographic axis <span class="arithmatex">\({\bf r}\)</span> (here assuming equal grain weight/size/mass for simplicity)</p>
<div class="arithmatex">\[ 
{\bf a}^{(2)}=\frac{1}{N}\sum_i^N {\bf r}_i\otimes{\bf r}_i 
,\quad 
{\bf a}^{(4)}=\frac{1}{N}\sum_i^N ({\bf r}_i\otimes)^4
,\quad 
{\bf a}^{(6)}=\frac{1}{N}\sum_i^N ({\bf r}_i\otimes)^6
.
\]</div>
<p>Converting between spectral and tensorial representations is a linear problem in the sense that </p>
<div class="arithmatex">\[ {\bf a}^{(2)} = {\bf f}(\hat{n}_2^{m})
,\quad
{\bf a}^{(4)} = {\bf g}(\hat{n}_0^0, \hat{n}_2^{m}, \hat{n}_4^{m}) 
,\quad
{\bf a}^{(6)} = {\bf h}(\hat{n}_2^{m}, \hat{n}_4^{m}, \hat{n}_6^{m}) 
,
\qquad\text{(for all $m$)}
\]</div>
<p>where <span class="arithmatex">\(\hat{n}_l^m := n_l^m/n_0^0\)</span>, and <span class="arithmatex">\({\bf f}\)</span>, <span class="arithmatex">\({\bf g}\)</span>, <span class="arithmatex">\({\bf h}\)</span> are linear in their arguments.</p>
<p>The following example shows how to convert between the representations:</p>
<pre><code class="language-python">import numpy as np
from specfabpy import specfabpy as sf
lm, nlm_len = sf.init(6) # L=6 truncation is sufficient in this case
nlm = np.zeros((nlm_len), dtype=np.complex64) # array of expansion coefficients

### a2 to nlm
a2 = np.diag([0.0,0.25,0.75]) # any second-order structure tensor (not necessarily diagonal)
nlm[:6] = sf.a2_to_nlm(a2) # Determine l=2 expansion coefficients of ODF (a2 is normalized)
a2 = sf.a2(nlm) # nlm back to a2
print('a2 is: ', a2)

### a4 to nlm
p = np.array([0,0,1]) # unidirectional fabric where all c-axes are aligned with the z-direction
a4 = np.einsum('i,j,k,l', p,p,p,p) # a4 for ODF = deltafunc(r-p) 
nlm[:15] = sf.a4_to_nlm(a4) # Determine l=2,4 expansion coefficients of ODF (a4 is normalized)
a4 = sf.a4(nlm) # nlm back to a4 
print('a4 is: ', a4)

### a6 to nlm
p = np.array([0,0,1]) # unidirectional fabric where all c-axes are aligned with the z-direction
a6 = np.einsum('i,j,k,l,m,n', p,p,p,p,p,p) # a6 for ODF = deltafunc(r-p) 
nlm[:] = sf.a6_to_nlm(a6) # Determine l=2,4,6 expansion coefficients of ODF (a6 is normalized)
a6 = sf.a6(nlm) # nlm back to a6
print('a6 is: ', a6)
</code></pre>
<h2 id="constructing-cpos-from-measurements">Constructing CPOs from measurements</h2>
<p>The spectral expansion coefficients of any CPO may be determined from discrete measurements of crystallographic axes.
This requires constructing the corresponding structure tensors (for each crystallographic axis), from which the expansion coefficients may be derived.</p>
<p>In the following example, a discrete ensemble of <span class="arithmatex">\(c\)</span>-axis measurements of ice crystals is presumed.</p>
<pre><code class="language-python">import numpy as np
from specfabpy import specfabpy as sf
lm, nlm_len = sf.init(6) 

# Pseuso-code -- replace with your own array/list of measured c-axes
# caxes = [[c1x,c1y,c1z], [c2x,c2y,c2z], ...] 

a6 = np.zeros((3,3,3,3,3,3))
for c in caxes
    a6 += np.einsum('i,j,k,l,m,n', c,c,c,c,c,c) # sixth outer product of c with itself
a6 /= len(caxes) # normalize by number of c-axes (grains)
</code></pre>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Constructing <code>a6</code> is to be preferred over <code>a4</code> and <code>a2</code> since it contains more information on the fine-scale structure of the distribution; 
<span class="arithmatex">\(l\leq 6\)</span> expansion coefficients as opposed to <span class="arithmatex">\(l\leq 4\)</span> and <span class="arithmatex">\(l\leq 2\)</span> coefficients, respectively.</p>
</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../initialize/" class="btn btn-neutral float-left" title="Loading specfab"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../cpo-dynamics/" class="btn btn-neutral float-right" title="Dynamics">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../initialize/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../cpo-dynamics/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
