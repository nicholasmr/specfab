<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Representation - specfab documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Representation";
        var mkdocs_page_input_path = "cpo-representation.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> specfab documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">üìñ About</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../install/">üì¶ Install</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">üíé CPO representation</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Representation</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#background">Background</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#mass-or-number-density-distributions">Mass or number density distributions?</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#harmonic-expansion">Harmonic expansion</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#reduced-form">Reduced form</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cpo-structuretensors/">Structure tensors</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cpo-idealized/">Idealized CPO states</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">‚öôÔ∏è CPO Dynamics</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../cpo-matrix-model/">Matrix model</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../lattice-rotation/">Lattice rotation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../recrystallization-DDRX/">Discontinous DRX</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../recrystallization-CDRX/">Continous DRX</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cpo-regularization/">Regularization</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">üåÄ Viscous Anisotropy</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../enhancements-strainrate/">Strain rate enhancement</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../enhancements-strainrate-ice/">Glacier ice</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../enhancements-strainrate-olivine/">Olivine</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">üåä Wave propagation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../wavepropagation-elastic/">Elastic</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../wavepropagation-electromagnetic/">Electromagnetic</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">üñºÔ∏è Application Gallery</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../Lagrangian-parcel/">Lagrangian parcel model</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../radar-derived-PP/">Radar-derived physical properties</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../FEM-integration/">Finite element integration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">üß© Miscellaneous</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../deformation-kinematics/">Deformation kinematics</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cpo-rotation/">Rotating CPOs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../constitutive-viscoplastic/">Viscoplastic constitutive equations</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../constitutive-elastic/">Elastic constitutive equations</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">specfab documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>üíé CPO representation &raquo;</li>
      <li>Representation</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="cpo-representation">CPO representation</h1>
<p>CPOs are represented by their distributions of crystallographic axes in orientation space (<span class="arithmatex">\(S^2\)</span>). 
Supported grain symmetry groups are:</p>
<table>
<thead>
<tr>
<th>Grain symmetry</th>
<th>CPO components</th>
<th>Definition</th>
</tr>
</thead>
<tbody>
<tr>
<td>Transversely isotropic</td>
<td><span class="arithmatex">\(n(\theta,\phi)\)</span></td>
<td>Distribution of slip-plane normals</td>
</tr>
<tr>
<td>Orthotropic</td>
<td><span class="arithmatex">\(n(\theta,\phi),\,b(\theta,\phi)\)</span></td>
<td>Distribution of slip-plane normals and slip directions</td>
</tr>
</tbody>
</table>
<p>Thus, depending on which crystallographic slip system is preferentially activated, <span class="arithmatex">\(n(\theta,\phi)\)</span> and <span class="arithmatex">\(b(\theta,\phi)\)</span> may refer to the distributions of different crystallographic axes.</p>
<div class="admonition note">
<p class="admonition-title">Glacier ice</p>
<table>
<thead>
<tr>
<th align="left"><center><div style="width:180px">Polycrystalline ice</div></center></th>
<th align="left"><center><div style="width:180px">Ensemble of slip elements</div></center></th>
<th align="left"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><img alt="" src="https://raw.githubusercontent.com/nicholasmr/specfab/main/images/tranisotropic/polycrystal-ice.png" style="width:200px" /></td>
<td align="left"><img alt="" src="https://raw.githubusercontent.com/nicholasmr/specfab/main/images/slip-plane/polycrystal-disk.png" style="width:200px" /></td>
<td align="left"><div style="width:200px;">Since ice grains are approximately<br> transversely isotropic, tracking<br> <span class="arithmatex">\(n(\theta,\phi)\)</span> (the <span class="arithmatex">\(c\)</span>-axis distribution)<br> is sufficient for representing<br> the CPO. </div></td>
</tr>
</tbody>
</table>
</div>
<div class="admonition tip">
<p class="admonition-title">Olivine</p>
<table>
<thead>
<tr>
<th align="left"><center><div style="width:180px">Polycrystalline olivine</div></center></th>
<th align="left"><center><div style="width:180px">Ensemble of slip elements</div></center></th>
<th align="left"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><img alt="" src="https://raw.githubusercontent.com/nicholasmr/specfab/main/images/orthotropic/polycrystal.png" style="width:200px" /></td>
<td align="left"><img alt="" src="https://raw.githubusercontent.com/nicholasmr/specfab/main/images/slip-plane/polycrystal-plane.png" style="width:200px" /></td>
<td align="left"><div style="width:200px;">For orthotropic grains such as<br> olivine, both <span class="arithmatex">\(n(\theta,\phi)\)</span> and <span class="arithmatex">\(b(\theta,\phi)\)</span><br> distributions must be tracked<br> to represent the CPO.<br><br> <u><em>Notice</em></u>: <span class="arithmatex">\(n\)</span> and <span class="arithmatex">\(b\)</span> represent the<br> distributions of a particular<br> crystallographic axes, depending<br> on fabric type (A&mdash;E type).</div></td>
</tr>
</tbody>
</table>
</div>
<h2 id="background">Background</h2>
<p>CPOs of ice and olivine are here defined as the size and orientation distribution of grains, without any reference to grain topology, grain shape, or the spatial arrangement of grains. 
In the general-most case, this means statistically describing the directions in which grain slip-plane normal and slip direction (<span class="arithmatex">\(n\)</span>- and <span class="arithmatex">\(b\)</span>-axes) are pointing while also taking into account how massive each grain is. </p>
<p>The <em>mass-density orientation distribution function</em> <span class="arithmatex">\(\rho^{*}({\bf n},{\bf b})\)</span> describes how grain mass is distributed in the space of possible grain orientations (<a href="https://royalsocietypublishing.org/doi/abs/10.1098/rspa.2005.1610">Faria, 2006</a>), where <span class="arithmatex">\({\bf n}(\theta,\phi)\)</span> and <span class="arithmatex">\({\bf b}(\theta,\phi)\)</span> are arbitrary <span class="arithmatex">\(n\)</span>- and <span class="arithmatex">\(b\)</span>-axes (unit vectors). Since <span class="arithmatex">\(\rho^{*}\)</span> is taken to be normalized by the polycrystal volume, integrating <span class="arithmatex">\(\rho^{*}\)</span> over all possible grain orientations recovers the mass density of the polycrystal (e.g. <span class="arithmatex">\(\rho=917\)</span> kg/m<span class="arithmatex">\(^3\)</span> for ice):
$$ 
\rho = \int_{S^2} \int_{S^2} \rho^{*}({\bf n},{\bf b}) \,\mathrm{d}^2{\bf b}\, \mathrm{d}^2{\bf n} ,
$$ 
where integration is restricted to the surface of the unit sphere <span class="arithmatex">\(S^2\)</span>, and <span class="arithmatex">\(\mathrm{d}^2{\bf n}=\sin(\theta)\,\mathrm{d}{\theta}\,\mathrm{d}{\phi}\)</span> is the infinitesimal solid angle in spherical coordinates (defined similarly for <span class="arithmatex">\({\bf a}\)</span>).</p>
<div class="admonition warning">
<p class="admonition-title">Ambiguity</p>
<p>Notice that defining CPOs in this way introduces some ambiguity. The contribution to <span class="arithmatex">\(\rho^{*}({\bf n},{\bf b})\)</span> from two grains with identical mass <span class="arithmatex">\(m\)</span> and orientation is indistinguishable from a single grain with the same orientation but twice the mass, <span class="arithmatex">\(2m\)</span>. Nonetheless, how well <span class="arithmatex">\(\rho^{*}({\bf n},{\bf b})\)</span> can represent CPOs should ultimately be judged by whether it contains the information necessary to calculate CPO-induced properties to some desired accuracy (say, bulk mechanical anisotropy); not by how simplified it is to disregard spatial (topological) grain information etc. </p>
</div>
<p><strong>Glacier ice</strong><br>
In the case of ice, specfab treats for simplicity approximate all monocrystal properties as isotropic in the basal plane (transverse isotropy). 
This popular approach simplifies the problem significantly: since it does not matter in which directions <span class="arithmatex">\(b\)</span>-axes (crystal <span class="arithmatex">\(a\)</span>-axes) point, it is not needed to keep track of how they are distributed.
Let therefore <span class="arithmatex">\(n(\theta,\phi)\)</span> be the corresponding distribution function of grain mass density in the space of possible <span class="arithmatex">\(n\)</span>-axis (crystal <span class="arithmatex">\(c\)</span>-axis) orientations:
$$ 
n(\theta,\phi) = \frac{\int_{S^2} \rho^{*}({\bf n},{\bf b})\,\mathrm{d}^2{\bf b}}{\rho} ,
$$
which is nothing but the normalized marginal distribution of <span class="arithmatex">\({\bf n}\)</span>.</p>
<p><strong>Olivine</strong><br>
Specfab represents more complicated minerals like olivine by, in addition, also tracking the marginal distribution of slip directions:
$$ 
b(\theta,\phi) = \frac{\int_{S^2} \rho^{*}({\bf n},{\bf b})\,\mathrm{d}^2{\bf n}}{\rho} .
$$
When needed, the joint distribution function <span class="arithmatex">\(\rho^{*}({\bf n},{\bf b})\)</span> is the back-constructed from its marginal distributions following the identity for conditional probability density functions <a href="https://doi.org/10.1029/2024GC011831">and some assumptions</a>. </p>
<h2 id="mass-or-number-density-distributions">Mass or number density distributions?</h2>
<p>The normalized distributions <span class="arithmatex">\(n(\theta,\phi)\)</span> and <span class="arithmatex">\(b(\theta,\phi)\)</span> are typically referred to as the Mass Orientation Distribution Functions (<strong>MODFs</strong>) or the Orientation Mass Distributions (<strong>OMDs</strong>).</p>
<p>In the literature, number density distributions, rather than mass density, frequently appear. 
In this case, <span class="arithmatex">\(n(\theta,\phi)/N\)</span> and <span class="arithmatex">\(b(\theta,\phi)/N\)</span> are understood as the normalized Orientation Distribution Functions (<strong>ODFs</strong>) of slip-plane normals and slip directions, respectively, where <span class="arithmatex">\(N = \int_{S^2} n(\theta,\phi) \,\mathrm{d}^2{\bf n}\)</span> is the total number of grains. 
In specfab's representation of <a href="../cpo-matrix-model/">crystal processes</a> (lattice rotation, DDRX, CDRX) the normalization is conserved and the two views give, in effect, the same result (not least because CPO-derived quantities depend on the normalized distributions, which are identical). 
The mass-density-fraction interpretation rests, however, on stronger physical grounds as mass is conserved whereas grain numbers are not.</p>
<!--

The orientation distribution function (ODF) of a given slip-system axis (crystallographic axis) $f\in \lbrace n,b\rbrace$ is defined as the normalized distribution

$$ 
\mathrm{ODF} = \frac{f(\theta,\phi)}{N} \quad\text{where}\quad N=\int_{S^2} f(\theta,\phi) \,\mathrm{d}\Omega .
$$

## Normalization

$n(\theta,\phi)$ may be understood either as the number density of grains with a given slip-plane normal orientation, or as the mass density fraction ([Faria, 2006](https://royalsocietypublishing.org/doi/abs/10.1098/rspa.2005.1610); [Richards et al., 2021](https://www.sciencedirect.com/science/article/abs/pii/S0012821X20306622)) of grains with a given slip-plane normal orientation; $\varrho^*(\theta,\phi)$ in literature.
The same goes for $b(\theta,\phi)$.

From specfab's point-of-view, the difference is a matter of normalization: since the models of [CPO evolution](cpo-dynamics-tranisotropic.md) (lattice rotation, DDRX, CDRX) conserve the normalization, the two views are effectively the same, not least because CPO-derived quantities depend on the normalized distributions (which are identical).
The mass-density-fraction interpretation rests, however, on stronger physical grounds as mass is conserved but grain numbers are not.

-->

<h2 id="harmonic-expansion">Harmonic expansion</h2>
<p><img alt="" src="https://raw.githubusercontent.com/nicholasmr/specfab/main/images/harmonic-expansion/harmonic-expansion.png#center" style="width:630px" /></p>
<p>The distributions <span class="arithmatex">\(n(\theta,\phi)\)</span> and <span class="arithmatex">\(b(\theta,\phi)\)</span> are represented as spherical harmonic expansion series:</p>
<div class="arithmatex">\[ 
n(\theta,\phi)=\sum_{l=0}^{L}\sum_{m=-l}^{l}n_{l}^{m}Y_{l}^{m}(\theta,\phi) \quad\text{(distribution of slip-plane normals)},
\]</div>
<div class="arithmatex">\[
b(\theta,\phi)=\sum_{l=0}^{L}\sum_{m=-l}^{l}b_{l}^{m}Y_{l}^{m}(\theta,\phi) \quad\text{(distribution of slip directions)}.
\]</div>
<p>The CPO state is thus described by the <em>state vectors</em> of complex-valued expansion coefficients</p>
<div class="arithmatex">\[
{\bf s}_n = [n_0^0,n_2^{-2},n_2^{-1},n_2^{0},n_2^{1},n_2^{2},n_4^{-4},\cdots,n_4^{4},\cdots,n_L^{-L},\cdots,n_L^{L}] \quad\text{($n$ state vector)}, 
\]</div>
<div class="arithmatex">\[
{\bf s}_b = [b_0^0,b_2^{-2},b_2^{-1},b_2^{0},b_2^{1},b_2^{2},b_4^{-4},\cdots,b_4^{4},\cdots,b_L^{-L},\cdots,b_L^{L}] \quad\text{($b$ state vector)}, 
\]</div>
<p>where the magnitude and complex phase of the coefficients determine the size and rotation of the contribution from the associated harmonic mode.</p>
<h3 id="reduced-form">Reduced form</h3>
<p>Not all expansion coefficients are independent for real-valued expansion series, but must fulfill</p>
<div class="arithmatex">\[ 
n_l^{-m}=(-1)^m(n_l^m)^* ,
\]</div>
<div class="arithmatex">\[ 
b_l^{-m}=(-1)^m(b_l^m)^* .
\]</div>
<p>This can be taken advantage of for large problems where many (e.g. gridded) CPOs must be stored in memory, thereby effectively reducing the size of the problem. 
The vectors of reduced expansion coefficients is defined as</p>
<div class="arithmatex">\[
\tilde{{\bf s}}_n = [n_0^0,n_2^{0},n_2^{1},n_2^{2},n_4^{0},\cdots,n_4^{4},\cdots,n_L^{0},\cdots,n_L^{L}] \quad\text{(reduced $n$ state vector)}.
\]</div>
<div class="arithmatex">\[
\tilde{{\bf s}}_b = [b_0^0,b_2^{0},b_2^{1},b_2^{2},b_4^{0},\cdots,b_4^{4},\cdots,b_L^{0},\cdots,b_L^{L}] \quad\text{(reduced $b$ state vector)}.
\]</div>
<p>Converting between full and reduced forms is done as follows (and similarly for <span class="arithmatex">\(\tilde{{\bf s}}_b\)</span>):</p>
<pre><code class="language-python">import numpy as np
from specfabpy import specfabpy as sf
lm, nlm_len = sf.init(2) # L=2 truncation is sufficient in this case

### Construct an arbitrary fabric
a2 = np.diag([0.1,0.2,0.7]) # arbitrary second-order structure tensor
nlm = np.zeros((nlm_len), dtype=np.complex64) # array of expansion coefficients
nlm[:sf.L2len] = sf.a2_to_nlm(a2) # determine l&lt;=2 expansion coefficients of ODF
print('original:', nlm)

### Get reduced form of coefficient array, rnlm
rnlm_len = sf.get_rnlm_len() 
rnlm = np.zeros((rnlm_len), dtype=np.complex64) # array of reduced expansion coefficients
rnlm[:] = sf.nlm_to_rnlm(nlm, rnlm_len) # reduced form
print('reduced:', rnlm)

### Recover full form (nlm) from reduced form (rnlm)
nlm[:] = sf.rnlm_to_nlm(rnlm, nlm_len)
print('recovered:', nlm)
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../install/" class="btn btn-neutral float-left" title="üì¶ Install"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../cpo-structuretensors/" class="btn btn-neutral float-right" title="Structure tensors">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../install/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../cpo-structuretensors/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
