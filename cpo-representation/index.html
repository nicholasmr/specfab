<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Representation - specfab documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Representation";
        var mkdocs_page_input_path = "cpo-representation.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> specfab documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">üìñ About</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../install/">üì¶ Install</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">üíé CPO representation</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Representation</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#background">Background</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#mass-or-number-density-distributions">Mass or number density distributions?</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#harmonic-expansion">Harmonic expansion</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#reduced-form">Reduced form</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cpo-structuretensors/">Structure tensors</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cpo-statespace/">State space</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">‚öôÔ∏è CPO Dynamics</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../fabdyn-matrix-model/">Matrix model</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fabdyn-LROT/">Lattice rotation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fabdyn-DDRX/">Discontinous DRX</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fabdyn-CDRX/">Continous DRX</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fabdyn-REG/">Regularization</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">üåÄ Viscosity</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../enhancements-strainrate/">Strain-rate enhancement</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../enhancements-strainrate-ice/">Glacier ice</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../enhancements-strainrate-olivine/">Olivine</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">üåä Wave propagation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../waveprop-elastic/">Elastic</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../waveprop-electromagnetic/">Electromagnetic</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">üñºÔ∏è Application Gallery</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../gallery-Lagrangian-CPO-parcel/">Lagrangian CPO parcel</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../gallery-Eulerian-CPO-field/">Eulerian CPO field</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../gallery-CPO-from-radar/">Inferring CPO from radar</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../gallery-CPO-flow-coupling/">Coupling CPO and flow</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">üß© Miscellaneous</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../deformation-kinematics/">Deformation kinematics</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cpo-plot/">Plot CPO</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cpo-rotation/">Rotate CPO</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../constitutive-viscoplastic/">Viscoplastic constitutive eqns.</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../constitutive-elastic/">Elastic constitutive eqns.</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">specfab documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>üíé CPO representation &raquo;</li>
      <li>Representation</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="representation">Representation</h1>
<p>The Crystallographic Preferred Orientation (CPO) of polycrystalline materials is represented by the distribution of crystal axes in orientation space, <span class="arithmatex">\(S^2\)</span>, weighted by grain size.</p>
<p>Supported grain symmetries, are:</p>
<table>
<thead>
<tr>
<th>Grain symmetry</th>
<th>CPO components</th>
<th>Definition</th>
</tr>
</thead>
<tbody>
<tr>
<td>Transversely isotropic</td>
<td><span class="arithmatex">\(n(\theta,\phi)\)</span></td>
<td>Distribution of slip-plane normals</td>
</tr>
<tr>
<td>Orthotropic</td>
<td><span class="arithmatex">\(n(\theta,\phi),\,b(\theta,\phi)\)</span></td>
<td>Distribution of slip-plane normals and slip directions</td>
</tr>
</tbody>
</table>
<p>Depending on which crystallographic slip system is preferentially activated, <span class="arithmatex">\(n(\theta,\phi)\)</span> and <span class="arithmatex">\(b(\theta,\phi)\)</span> refer to the distributions of different crystallographic axes.</p>
<div class="admonition note">
<p class="admonition-title">Glacier ice</p>
<table>
<thead>
<tr>
<th align="left"><center><div style="width:180px">Polycrystalline ice</div></center></th>
<th align="left"><center><div style="width:180px">Ensemble of slip elements</div></center></th>
<th align="left"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><img alt="" src="https://raw.githubusercontent.com/nicholasmr/specfab/main/images/tranisotropic/polyice-iso.png" style="width:200px" /></td>
<td align="left"><img alt="" src="https://raw.githubusercontent.com/nicholasmr/specfab/main/images/slip-plane/polycrystal-disk.png" style="width:200px" /></td>
<td align="left"><div style="width:200px;">Since ice grains are approximately<br> transversely isotropic, tracking<br> <span class="arithmatex">\(n(\theta,\phi)\)</span> (the <span class="arithmatex">\(c\)</span>-axis distribution)<br> is sufficient for representing<br> the CPO of glacier ice. </div></td>
</tr>
</tbody>
</table>
</div>
<div class="admonition tip">
<p class="admonition-title">Olivine</p>
<table>
<thead>
<tr>
<th align="left"><center><div style="width:180px">Polycrystalline olivine</div></center></th>
<th align="left"><center><div style="width:180px">Ensemble of slip elements</div></center></th>
<th align="left"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><img alt="" src="https://raw.githubusercontent.com/nicholasmr/specfab/main/images/orthotropic/polyoli-iso.png" style="width:200px" /></td>
<td align="left"><img alt="" src="https://raw.githubusercontent.com/nicholasmr/specfab/main/images/slip-plane/polycrystal-plane.png" style="width:200px" /></td>
<td align="left"><div style="width:200px;">For orthotropic grains such as<br> olivine, both <span class="arithmatex">\(n(\theta,\phi)\)</span> and <span class="arithmatex">\(b(\theta,\phi)\)</span><br> distributions must be tracked<br> to represent the CPO.<br><br> <u><em>Notice</em></u>: <span class="arithmatex">\(n\)</span> and <span class="arithmatex">\(b\)</span> represent the<br> distributions of a particular<br> crystallographic axes, depending<br> on fabric type (A&mdash;E type).</div></td>
</tr>
</tbody>
</table>
</div>
<h2 id="background">Background</h2>
<p>In <em>specfab</em>, CPOs are  defined as the orientation distribution of grains without any reference to grain topology, grain shape, or the spatial arrangement of grains. 
More precisely, this means statistically describing the directions in which the slip-plane normal and slip direction of grains (<span class="arithmatex">\(n\)</span>- and <span class="arithmatex">\(b\)</span>-axes) are pointing, while also taking into account how massive each grain is (weighted by grain size). </p>
<p>The <em>mass-density orientation distribution function</em> <span class="arithmatex">\(\rho^{*}({\bf n},{\bf b})\)</span> describes how grain mass is distributed in the space of possible grain orientations (<a href="https://royalsocietypublishing.org/doi/abs/10.1098/rspa.2005.1610">Faria, 2006</a>), where <span class="arithmatex">\({\bf n}(\theta,\phi)\)</span> and <span class="arithmatex">\({\bf b}(\theta,\phi)\)</span> are arbitrary <span class="arithmatex">\(n\)</span>- and <span class="arithmatex">\(b\)</span>-axes (radial unit vectors). 
Since <span class="arithmatex">\(\rho^{*}\)</span> is by definition normalized by the polycrystal volume, integrating <span class="arithmatex">\(\rho^{*}\)</span> over all possible grain orientations recovers the mass density of the polycrystal (e.g., <span class="arithmatex">\(\rho=917\)</span> kg/m<span class="arithmatex">\(^3\)</span> for glacier ice):
$$ 
\rho = \int_{S^2} \int_{S^2} \rho^{*}({\bf n},{\bf b}) \,\mathrm{d}^2{\bf b}\, \mathrm{d}^2{\bf n} ,
$$ 
where integration is restricted to the surface of the unit sphere <span class="arithmatex">\(S^2\)</span> and <span class="arithmatex">\(\mathrm{d}^2{\bf n}=\sin(\theta)\,\mathrm{d}{\theta}\,\mathrm{d}{\phi}\)</span> is the infinitesimal solid angle in spherical coordinates (similarly for <span class="arithmatex">\({\bf b}\)</span>).</p>
<div class="admonition warning">
<p class="admonition-title">Ambiguity</p>
<p>Notice that defining the CPO in this way introduces some ambiguity. The contribution to <span class="arithmatex">\(\rho^{*}({\bf n},{\bf b})\)</span> from two grains with identical mass <span class="arithmatex">\(m\)</span> and orientation is indistinguishable from a single grain with the same orientation but twice the mass, <span class="arithmatex">\(2m\)</span>. Nonetheless, how well <span class="arithmatex">\(\rho^{*}({\bf n},{\bf b})\)</span> represents a CPO should ultimately be judged by whether it contains the information necessary to calculate CPO-induced properties to some desired accuracy (say, bulk mechanical anisotropy); not by how simplified it is to disregard the spatial (topological) information of grains.</p>
</div>
<p><strong>Glacier ice</strong><br>
In the case of ice, <em>specfab</em> treats for simplicity all monocrystal properties as isotropic in the basal plane (transverse isotropy). 
This popular approach simplifies the problem significantly: since it does not matter in which direction <span class="arithmatex">\(b\)</span>-axes (crystal <span class="arithmatex">\(a\)</span>-axes) point, there is no need to track how they are distributed. 
Let therefore <span class="arithmatex">\(n(\theta,\phi)\)</span> be the corresponding normalized, <em>marginal</em> distribution function of the grain mass-density in the space of possible <span class="arithmatex">\(n\)</span>-axis orientations (crystal <span class="arithmatex">\(c\)</span>-axis orientations):
$$ 
n(\theta,\phi) = \frac{\int_{S^2} \rho^{*}({\bf n},{\bf b})\,\mathrm{d}^2{\bf b}}{\rho} .
$$</p>
<p><strong>Olivine</strong><br>
More complicated minerals like olivine are represented by also tracking the marginal distribution of slip directions:
$$ 
b(\theta,\phi) = \frac{\int_{S^2} \rho^{*}({\bf n},{\bf b})\,\mathrm{d}^2{\bf n}}{\rho} .
$$
If needed, the joint distribution function <span class="arithmatex">\(\rho^{*}({\bf n},{\bf b})\)</span> can be estimated from its marginal distributions following the identity for conditional probability density functions <a href="https://doi.org/10.1029/2024GC011831">and some assumptions</a>. </p>
<h2 id="mass-or-number-density-distributions">Mass or number density distributions?</h2>
<p>The normalized, marginal distributions <span class="arithmatex">\(n(\theta,\phi)\)</span> and <span class="arithmatex">\(b(\theta,\phi)\)</span> are typically referred to as Mass Orientation Distribution Functions (MODFs) or Orientation Mass Distributions (OMDs).</p>
<p>In the literature, <em>number-density</em> distributions, rather than mass-density, frequently appear. 
In this case, <span class="arithmatex">\(n(\theta,\phi)/N\)</span> and <span class="arithmatex">\(b(\theta,\phi)/N\)</span> are referred to as the normalized Orientation Distribution Functions (ODFs) of slip-plane normals and slip directions, respectively, where <span class="arithmatex">\(N = \int_{S^2} n(\theta,\phi) \,\mathrm{d}^2{\bf n}\)</span> is the total number of grains. </p>
<p>In the <a href="../fabdyn-matrix-model/">models of crystal processes</a> available in <em>specfab</em>, the normalization is conserved and the two views give, in effect, the same result. 
The mass-density interpretation representation rests, however, on stronger physical grounds, since mass is conserved whereas grain numbers are not.</p>
<h2 id="harmonic-expansion">Harmonic expansion</h2>
<p><img alt="" src="https://raw.githubusercontent.com/nicholasmr/specfab/main/images/harmonic-expansion/harmonic-expansion.png#center" style="width:630px" /></p>
<p>The distributions <span class="arithmatex">\(n(\theta,\phi)\)</span> and <span class="arithmatex">\(b(\theta,\phi)\)</span> are represented as an expansion series in spherical harmonics</p>
<div class="arithmatex">\[ 
n(\theta,\phi)=\sum_{l=0}^{L}\sum_{m=-l}^{l}n_{l}^{m}Y_{l}^{m}(\theta,\phi) \quad\text{(distribution of slip-plane normals)},
\]</div>
<div class="arithmatex">\[
b(\theta,\phi)=\sum_{l=0}^{L}\sum_{m=-l}^{l}b_{l}^{m}Y_{l}^{m}(\theta,\phi) \quad\text{(distribution of slip directions)}.
\]</div>
<p>The CPO state is therefore described by the <em>state vectors</em> of complex-valued expansion coefficients</p>
<div class="arithmatex">\[
{\bf s}_n = [n_0^0,n_2^{-2},n_2^{-1},n_2^{0},n_2^{1},n_2^{2},n_4^{-4},\cdots,n_4^{4},\cdots,n_L^{-L},\cdots,n_L^{L}] \quad\text{($n$ state vector)}, 
\]</div>
<div class="arithmatex">\[
{\bf s}_b = [b_0^0,b_2^{-2},b_2^{-1},b_2^{0},b_2^{1},b_2^{2},b_4^{-4},\cdots,b_4^{4},\cdots,b_L^{-L},\cdots,b_L^{L}] \quad\text{($b$ state vector)}, 
\]</div>
<p>where the magnitude and complex phase of each coefficient determines the size and rotation that a given harmonic contributes with.</p>
<h3 id="reduced-form">Reduced form</h3>
<p>Not all expansion coefficients are independent for real-valued expansion series, but must fulfill</p>
<div class="arithmatex">\[ 
n_l^{-m}=(-1)^m(n_l^m)^* ,
\]</div>
<div class="arithmatex">\[ 
b_l^{-m}=(-1)^m(b_l^m)^* .
\]</div>
<p>This can be taken advantage of for large problems where many (e.g. gridded) CPOs must be stored in memory, thereby reducing the dimensionality of the problem. 
The vectors of reduced expansion coefficients are defined as</p>
<div class="arithmatex">\[
\tilde{{\bf s}}_n = [n_0^0,n_2^{0},n_2^{1},n_2^{2},n_4^{0},\cdots,n_4^{4},\cdots,n_L^{0},\cdots,n_L^{L}] \quad\text{(reduced $n$ state vector)}.
\]</div>
<div class="arithmatex">\[
\tilde{{\bf s}}_b = [b_0^0,b_2^{0},b_2^{1},b_2^{2},b_4^{0},\cdots,b_4^{4},\cdots,b_L^{0},\cdots,b_L^{L}] \quad\text{(reduced $b$ state vector)}.
\]</div>
<p>Converting between full and reduced forms is done as follows (similarly for <span class="arithmatex">\(\tilde{{\bf s}}_b\)</span>):</p>
<pre><code class="language-python">import numpy as np
from specfabpy import specfabpy as sf
lm, nlm_len = sf.init(6)

### Construct an arbitrary fabric state
a2 = np.diag([0.1,0.2,0.7]) # some second-order structure tensor
nlm = np.zeros((nlm_len), dtype=np.complex64) # full form of state vector
nlm[:sf.L2len] = sf.a2_to_nlm(a2) # l&lt;=2 expansion coefficients from a2
print('original:', nlm)

### Get reduced form of state vector, rnlm
rnlm_len = sf.get_rnlm_len() 
rnlm = np.zeros((rnlm_len), dtype=np.complex64) # reduced state vector
rnlm[:] = sf.nlm_to_rnlm(nlm, rnlm_len) # reduced form
print('reduced:', rnlm)

### Recover full form (nlm) from reduced form (rnlm)
nlm[:] = sf.rnlm_to_nlm(rnlm, nlm_len)
print('recovered:', nlm)
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../install/" class="btn btn-neutral float-left" title="üì¶ Install"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../cpo-structuretensors/" class="btn btn-neutral float-right" title="Structure tensors">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../install/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../cpo-structuretensors/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
